# MSA (Micro Service Architecture)

마이크로서비스란 작고, 독립적으로 배포 가능한 각각의 기능을 수행하는 서비스로 구성된 프레임워크라고 할 수 있다. 마이크로서비스는 완전히 독립적으로 배포가 가능하고, 다른 기술 스택(개발 언어, 데이터베이스 등)이 사용 가능한 단일 사업 영역에 초점을 둔다.

## 1. 등장 배경

- 부분 장애가 전체 서비스의 장애로 확대될 수 있다.
- 부분적인 Scale-out(여러 server로 나누어 일을 처리하는 방식)이 어렵다.
- 서비스의 변경이 어렵고, 수정 시 장애의 영향도 파악이 힘들다.
- 배포 시간이 오래 걸린다.
- 하나의 Framework와 언어에 종속적이다.

## 2. 장단점

### 장점

- 독립적 진화 및 배포가 가능하다.
- 트래픽이 몰릴 경우 필요한 서버만 scale-out을 진행할 수 있다.
- 기술 스택을 자유롭게 가져갈 수 있다. (프레임워크, 언어, DataBase 등)
- 장애를 격리할 수 있다.

### 단점

- 복잡하다. 
- 트랜잭션에 대한 관리가 힘들어지고 롤백 전략이나 글로벌 트랜잭션에 대해 관리가 필요하다.
- 통합테스트거 어렵다.
- 기능 하나에 여러 서비스가 연계될 경우 확인이 쉽지 않다. 

## 3. MSA와 잘어울리는 이벤트 소싱 기법

이벤트 소싱은 도메인 모델에서 발생하는 모든 이벤트를 기록하는 데이터 저장 기법이다.

- 장점
    - 버그 추적 용이 (이벤트들을 추적하기 좋다)
    - MSA와 좋은 시너지
    - 객체 지향과 좋은 궁합
    - **임피던스 불일치(객체-관계 불일치)가 존재하지 않는다.**
        - 도메인에 새로운 상태가 추가되어도 DB와 도메인 모델 사이의 임피던스 불일치가 발생하지 않는다.
- 단점
    - 어렵다, 단순모델에 적합하지 않다.
    - 복합 조회 문제
        - 이벤트들을 다 가져와서 재생 한 후에 조회해야 하기 때문에. (필수로 CQRS와 사용함)
- 조합
    - MSA - 비동기 작업 흐름에 알맞게 동작한다.
    - CQRS - 이벤트 저장소가 비즈니스의 다양한 데이터 조회 요구를 수용하기 어렵다는 점을 해결한다.