# 6장 선택적 데이터 처리하기
참조 타입의 데이터가 없음을 표현하는 가장 일반적인 방법으로 아무것도 가리키지 않는 포인터를 사용한다. 이런 포인터를 널 포인터(Null pointer)라고 부른다. Null reference는 아무것도 가리키지 않는 참조로, 나중에 이 참조가 어떤 데이터를 가리키도록 대입할 수 있다. 이번 장에서는 오류가 발생하지 않았는데 데이터가 존재하지 않는 경우인 선택적 데이터를 처리하는 방법을 배운다.

## 6.1 널 포인터의 문제점

> 나는 그것(널 참조)을 십억 불 짜리 실수라고 부른다.

널 참조를 허용하는 프로그램에서 가장 자주 발생하는 버그는 NullPointerException이다. 이 예외는 데이터가 필요한 부분에서 데이터가 null일 경우 발생한다.

널 참조를 사용하지 않아야 한다는 것이 상식이 되었지만 현실은 그와 거리가 멀다.
java.net.Socket의 클래스를 예로 보자.

### 비즈니스 널

```java
public Socket(String host,
              int port,
              InetAddress localAddr,
              int localPort)
       throws IOException1
```

문서를 보면 다음과 같다.

> 로컬 주소(localAddr)를 null로 설정하면 address로 주어진 주소를 로컬 주소로 설정하는 것과 같다.

이러한 값을 비즈니스 널이라 한다.

### 센티넬 값

> 로컬 포트 번호를 0으로 설정하면 소켓 주소를 바인드할 때 시스템이 비어있는 포트를 소켓 로컬 포트로 할당한다.

이런 종류의 값을 때로는 센티넬 값이라고 부른다. 이 값은 0이라는 값 자체를 표현하기 위한 것이 아니고 포트 값이 존재하지 않음을 표현하기 위한 것이다.

또 다른 예로 HashMap에 값이 null이거나 키가 null인 경우도 있다. 이러한 상황들은 상황을 엉망진창으로 만들고 여러분은 전문가로서 이런 상황을 어떻게 정리할지 알아야 한다.

- 참조가 null인지 아닌지를 확인하지 않고는 절대 참조를 사용하지 말아야 한다(함수가 받는 모든 객체 파라미터에 대해 이를 확인해야 한다)
- 맵 안에 키가 존재하는지 아닌지를 먼저 확인하지 않고는 절대 맵에서 값을 가져와서는 안된다.
- 리스트 원소를 인덱스로 참조할 경우에는 리스트가 비어 있지 않고 리스트 길이가 원하는 인덱스 값보다 크다는 사실을 확인하지 않고는 절대 리스트에서 원소를 얻으려 해서는 안된다.

이 세가지를 지킨다면 절대 NPE를 만나지 않고 살 수 있겠지만 이러한 방법을 지키지 못하면 끔찍한 예외를 마주치게 된다.

이 자에서는 오류의 결과로 값이 없는 경우가 아니라 정상적인 상황인데 값이 없는 경우를 표현하는 방법을 배운다. 이런 데이터를 선택적 데이터라고 부른다.

리스트를 선택적 데이터와 같이 쓸 수 있지만 단점이 존재한다.

- 리스트의 원소를 최대 하나로 제한할 방법이 없다.
- 원소를 최대 하나만 담을 수 있는 리스트를 어떻게 구분할 수 있을까?
- List 클래스는 리스트에 원소가 여럿 있다는 사실을 전제로 만들어진 함수가 많아 값의 부재와 존재를 구분하는데에 쓸모가 없다.
- 리스트처럼 복잡한 데이터 구조가 필요하지 않다.

## 6.2 코틀린이 Null reference를 처리하는 방식

코틀린은 널 참조를 사용한다. 하지만 참조가 널이 될 수 있다는 사실을 인식하고 있다고 컴파일러에게 미리 알려야 한다. 컴파일러에게 알리는 것만으로 NPE를 완전히 방지할 수는 없지만, 개발자에게 NPE 발생을 막을 수 있는 책임이 있음을 알리는 효과가 있다.

코틀린에서 일반 타입에 대한 참조는 널로 설정할 수 업승며  널이 될 수 있는 타입을 사용하려면 똑같은 타입 이름뒤에 ?를 덧붙여야 한다. (`Int`는 널 참조 불가, `Int?`는 널 참조 가능)

## 6.3 널 참조에 대한 대안

널 참조에 대한 방안은 자신의 코드에서 NPE가 발생하지 않음을 아는 것처럼 단순하지만은 않다.

- 널이 될 수 있는 타입을 인자로 받는 함수에 항상 널이 될 수 없는 타입의 값을 넘길 수 있다.
- 개발자의 코드에서는 겨우 null을 쫓아낼 수 있다고 해도 결국 사용하는 라이브러리에서 null을 보게 될 것이다.